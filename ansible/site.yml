---
- name: Setting Up Cluster
  hosts: aws_ec2
  become: true
  roles:
    - hostnames
    - dependency-packages
    - kube-packages
    - container-runtime

- name: Init Cluster
  hosts: control_planes[0]
  become: true
  environment:
    KUBECONFIG: "{{kube_config}}"
  roles:
    - init-cluster
    - container-network

- name: Join Control Planes
  hosts: control_planes:!control_planes[0]
  become: true
  roles:
    - join-control-planes

- name: Join Workers
  hosts: workers
  become: true
  roles:
    - join-workers

- name: Setting Up Cluster Auto Scaler
  hosts: control_planes[0]
  become: true
  environment:
    KUBECONFIG: "{{kube_config}}"
  roles:
    - cluster-autoscaler
